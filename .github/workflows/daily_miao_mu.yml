# å–µå§† AI è‚¡å¸‚åµæ¸¬ç«™ - æ¯æ—¥è‡ªå‹•åŸ·è¡Œå·¥ä½œæµ
# å°ç£æ™‚é–“ 15:30 (UTC 07:30) åŸ·è¡Œ

name: æ¯æ—¥å–µå§†è‚¡å¸‚åˆ†æ

on:
  schedule:
    # UTC 07:30 = å°ç£æ™‚é–“ 15:30
    - cron: '30 7 * * 1-5'  # é€±ä¸€è‡³é€±äº”
  workflow_dispatch:  # å…è¨±æ‰‹å‹•è§¸ç™¼

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  analyze-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout ç¨‹å¼ç¢¼
        uses: actions/checkout@v4
      
      - name: ğŸ è¨­å®š Python ç’°å¢ƒ
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: ğŸ“¦ å®‰è£å¥—ä»¶
        run: |
          pip install --upgrade pip
          pip install -r requirements.txt
      
      - name: ğŸ± åŸ·è¡Œå–µå§†åˆ†æ
        env:
          PERPLEXITY_API_KEY: ${{ secrets.PERPLEXITY_API_KEY }}
          LINE_TOKEN: ${{ secrets.LINE_TOKEN }}
          USER_ID: ${{ secrets.USER_ID }}
          FINMIND_TOKEN: ${{ secrets.FINMIND_TOKEN }}
        run: |
          python main.py
      
      - name: ğŸ“„ æº–å‚™ GitHub Pages
        run: |
          mkdir -p gh-pages
          cp index.html gh-pages/
          # å¦‚æœæœ‰å…¶ä»–éœæ…‹è³‡æºä¹Ÿè¤‡è£½éå»
          # cp -r assets gh-pages/ 2>/dev/null || true
      
      - name: ğŸš€ éƒ¨ç½²åˆ° GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./gh-pages
          publish_branch: gh-pages
          force_orphan: true
          commit_message: 'ğŸ± å–µå§†å ±è¡¨æ›´æ–° ${{ github.run_id }}'
